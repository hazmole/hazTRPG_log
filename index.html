<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta property="og:title" content="哈絲的團務彙整站">
	<meta property="og:type" content="website">
	<title>哈絲的團務彙整站</title>
	<script src="./index.js"></script>
	<script>
		var INDEX;

		function init() {
			// Render PageLink Object
			var options = INDEX.map( (link, idx) => {
				return `<option value="${link.url}"><span class="label">【${link.system}】${link.title}</span></option>`;
			});
			var firstOpt = `<option value="" selected disabled><span class="label">── 選擇團錄 ──</span></option>`;
			
			var selectorElem = document.getElementById("DropdownMenu");
			selectorElem.innerHTML = [ firstOpt , ...options ].join('');

			// Set Default Page
			var pageUrl = getCurrentPageUrl();
			linkByUrl(pageUrl);
		}
		function onMessage(event) {
			const index = event.data['replay-index'];
			linkByIndex(index);
		}



		function select(elem) {
			linkByUrl(elem.value);
		}
		function linkByUrl(url) {
			const idx = INDEX.findIndex(replay => replay.url === url);
			linkByIndex((idx === -1)? "": idx);
		}
		function linkByIndex(idx){
			const replayObj = INDEX[idx];
			const iframeElem = document.getElementById("MainContext");
			const selectElem = document.getElementById("DropdownMenu");

			if (idx === "") {
				// goto "Welcome.html"
				iframeElem.src = 'welcome.html';
				selectElem.selectedIndex = 0;
				updatePageParam("");
			} else {
				// goto Replay
				iframeElem.src = (replayObj.url + '/index.html');
				selectElem.selectedIndex = (parseInt(idx) + 1);
				updatePageParam(replayObj.url);
			}

		}
		function getLinkIdxByUrl(url){
			var linkIdx = INDEX.findIndex( link => link.url == url );
			return linkIdx;
		}
		function getLinkElemByIdx(idx){
			return document.getElementsByClassName('LinkObj')[idx];
		}
		function getCurrentPageUrl(){
			const urlParams = new URLSearchParams(window.location.search);
			const currentPageUrl = urlParams.get('p');
			if(getLinkIdxByUrl(currentPageUrl)<0) return '';
			return currentPageUrl;
		}
		function updatePageParam(url){
			const urlParams = new URLSearchParams(window.location.search);
			const path = window.location.pathname;
			urlParams.set('p', url);
			window.history.pushState({}, '', path+`?${urlParams.toString()}`);
		}

		window.onload = init;
		window.addEventListener("message", onMessage, false);
	</script>
	<style>
		body { background:#454752; color:white; margin:0; }
		#MainFrame { width: 100%; height: 100%; }
		#MainNavbar  { flex-grow: 0; height: auto; background: #141414; }
		#Title { text-align: center; font-size: 20px; padding: 1rem; }
		#Options { flex-grow: 1; overflow-y: auto; margin: 10px; display: flex; align-items: center; }
		#MainContext { flex-grow: 1; border:0; width: calc(100vw); }

		.row { display: flex; flex-direction: row; }
		.colume { display: flex; flex-direction: column; }
		.clickable { cursor: pointer; }

		.LinkObj { padding: 5px; margin:5px 0; background: black; border:3px groove #979494; }
		.LinkObj.active { filter: brightness(1.5); background: #101232; }
		.LinkObj:hover { filter: brightness(1.5); background: #101232; }
		.LinkObj:active { filter: brightness(0.8); }
		.LinkObj .system-name { color: #aaa; }
		.LinkObj .game-name   { padding-left: 1rem; }

		select,
		::picker(select) {
			appearance: base-select;
		}
		select {
			border: 2px solid #dddddd;
			background: #eeeeee; color: #000;
			min-width: 250px;
			padding: 5px 10px;
			transition: 0.4s;
			font-size: 1em;
		}
		select:hover, select:focus { background: #dddddd; }
		select::picker-icon { color: #999999; margin-top: 5px; }
		select:open::picker-icon { rotate: 180deg; margin-top: 1px; }

		::picker(select) {
			border: none;
			background: none;
			top: calc(anchor(bottom) + 1px);
			max-height: 460px;
		}

		option {
			display: flex;
			justify-content: flex-start;
			gap: 20px;

			border: 2px solid #dddddd;
			background: #eeeeee;
			padding: 10px;
			transition: 0.4s;
		}
		option:first-of-type { border-radius: 8px 8px 0 0; }
		option:last-of-type  { border-radius: 0 0 8px 8px; }
		option:not(option:last-of-type) { border-bottom: none; }
		option:nth-of-type(odd) { background: white; }

		option:hover,
		option:focus { background: #99939f; }
		option:checked { font-weight: bold; }
		option::checkmark { order: 1; margin-left: auto; content: "✔"; }

		::picker(select) { opacity: 0; transition: all 0.4s allow-discrete; }
		::picker(select):popover-open { opacity: 1; }
		@starting-style {
			::picker(select):popover-open { opacity: 0; }
		}

	</style>
</head>
<div id="MainFrame" class="colume">
	<div id="MainNavbar" class="row">
		<div id="Title" class="clickable" onClick="linkByIndex('')">哈絲的團務彙整站</div>
		<div id="Options">
			<select id="DropdownMenu" onchange="select(this)">
			</select>
		</div>
	</div>
	<iframe id="MainContext" type="text/html" src="" >
		你的瀏覽器不支援 iframe
	</iframe>
</div>
</html>